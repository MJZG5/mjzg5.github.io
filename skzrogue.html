<!DOCTYPE html>
<html>
<head>
    <title>明日方舟集成战略计分器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        label {
            display: block;
            margin: 5px 0;
        }
        input[type="number"] {
            width: 120px;
            padding: 5px;
            margin: 5px 0;
        }
        #result {
            font-size: 24px;
            font-weight: bold;
            color: #27ae60;
        }
        .ending-group {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            align-items: center;
        }
        .ending-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .extra-option {
            margin-left: 25px;
            padding: 5px 0;
        }
        .radio-group {
            display: flex;
            gap: 15px;
            margin: 10px 0;
        }
        .button-group {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 8px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <!-- 紧急加分 -->
    <div class="section">
        <h2>紧急加分</h2>
        <div class="grid">
            <div>
                <h3>四层紧急</h3>
                <label><input type="checkbox" data-emergency="25">猩红甬道</label>
                <label><input type="checkbox" data-emergency="50">神出鬼没</label>
                <label><input type="checkbox" data-emergency="40">混沌</label>
                <label><input type="checkbox" data-emergency="65">争议频发</label>
            </div>
            <div>
                <h3>五层紧急</h3>
                <label><input type="checkbox" data-emergency="40">计划耕种</label>
                <label><input type="checkbox" data-emergency="65">建制</label>
                <label><input type="checkbox" data-emergency="60">莱茵卫士</label>
            </div>
            <div>
                <h3>六层紧急</h3>
                <label><input type="checkbox" data-emergency="50">谋求共识</label>
                <label><input type="checkbox" data-emergency="50">神圣的渴求</label>
                <label><input type="checkbox" data-emergency="80">洞天福地</label>
                <label><input type="checkbox" data-emergency="65">外道</label>
            </div>
        </div>
    </div>

    <!-- 特殊作战 -->
    <div class="section">
        <h2>特殊作战加分</h2>
        <div class="grid">
            <label><input type="checkbox" data-special="20">劫虚济实 无漏</label>
            <label><input type="checkbox" data-special="30">战场侧面 无漏</label>
            <label><input type="checkbox" data-special="35">紧急信号灯 无漏</label>
            <label><input type="checkbox" data-special="50">鸭速公路 无漏</label>
        </div>
    </div>

    <!-- 道具加分 -->
    <div class="section">
        <h2>道具加分</h2>
        <label><input type="checkbox" id="rolling">持有滚动先祖 </label>
        <label><input type="checkbox" id="anasa">持有阿纳萨羯魔 </label>
    </div>

    <!-- 结局加分 -->
    <div class="section">
        <h2>结局加分</h2>
        
        <!-- 三层关底 -->
        <div class="ending-group">
            <h3>三层关底：</h3>
            <div class="radio-group">
                <label class="ending-option">
                    <input type="radio" name="ending3" value="20">
                    <span>或然面纱/奉献/斩首</span>
                </label>
                <label class="ending-option">
                    <input type="radio" name="ending3" value="30">
                    <span>离歌的庭院/赴敌者/王冠之下</span>
                </label>
            </div>
        </div>

        <!-- 五层结局 -->
        <div class="ending-group">
            <h3>五层结局：</h3>
            <div class="radio-group">
                <label class="ending-option">
                    <input type="radio" name="ending5" value="emergency_teaching">
                    <span>紧急授课/思维矫正</span>
                </label>
                <label class="ending-option">
                    <input type="radio" name="ending5" value="chaoyue">
                    <span>朝谒/魂灵朝谒</span>
                </label>
            </div>
        </div>

        <!-- 六层结局 -->
        <div class="ending-group">
            <h3>六层结局：</h3>
            <div class="radio-group">
                <label class="ending-option">
                    <input type="radio" name="ending6" value="sacred_city">
                    <span>圣城</span>
                </label>
                <label class="ending-option">
                    <input type="radio" name="ending6" value="shoufa">
                    <span>授法</span>
                </label>
            </div>
        </div>
        <div id="shoufaExtra" class="extra-option" style="display:none;">
            <label>
                <input type="checkbox" id="kill_kuilong">
                击杀奎隆
            </label>
            <label>
                <input type="checkbox" id="shoufa_mind_chaos">
                思维混乱状态
            </label>
        </div>
    </div>

    <!-- 不容拒绝 -->
    <div class="section">
        <h2>不容拒绝</h2>
        <div class="radio-group">
            <label class="ending-option">
                <input type="radio" name="no_refuse" value="100">
                <span>终结的骨架</span>
            </label>
            <label class="ending-option">
                <input type="radio" name="no_refuse" value="120">
                <span>终结的躯体</span>
            </label>
            <label class="ending-option">
                <input type="radio" name="no_refuse" value="160">
                <span>终结的实相</span>
            </label>
        </div>
        <label class="extra-option">
            <input type="checkbox" id="mind_chaos">
            思维混乱
        </label>
    </div>

    <!-- 最终计算 -->
    <div class="section">
        <h2>最终计算</h2>
        <label>输入结算分：<input type="number" id="settlement" value="0"></label>
        <label>藏品数：<input type="number" id="collection" value="0"></label>
        <div class="button-group">
            <button onclick="resetAll()">重置所有选项</button>
            <button onclick="calculate()">刷新当前分数</button>
        </div>
        <div style="margin-top:15px;">
            最终得分：<span id="result">0</span>
        </div>
    </div>

    <script>
        // 可取消的单选逻辑
        function makeRadiosCancellable(radioName) {
            document.querySelectorAll(`input[type="radio"][name="${radioName}"]`).forEach(radio => {
                radio.addEventListener('click', function(e) {
                    if(this.checked && this.dataset.lastState === 'true') {
                        this.checked = false;
                    }
                    this.dataset.lastState = this.checked;
                });
            });
        }

        // 初始化可取消的单选组（包含不容拒绝）
        ['ending3', 'ending5', 'ending6', 'no_refuse'].forEach(group => makeRadiosCancellable(group));

        // 授法额外选项显示
        document.querySelectorAll('input[name="ending6"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const extraDiv = document.getElementById('shoufaExtra');
                const showExtra = this.value === 'shoufa' && this.checked;
                extraDiv.style.display = showExtra ? 'block' : 'none';
                
                if(!showExtra) {
                    document.getElementById('kill_kuilong').checked = false;
                    document.getElementById('shoufa_mind_chaos').checked = false;
                }
            });
        });

        function calculate() {
            // 紧急加分（使用data-emergency）
            const emergency = Array.from(document.querySelectorAll('[data-emergency]:checked'))
                .reduce((sum, cb) => sum + parseInt(cb.dataset.emergency), 0);

            // 特殊作战（使用data-special） 
            const special = Array.from(document.querySelectorAll('[data-special]:checked'))
                .reduce((sum, cb) => sum + parseInt(cb.dataset.special), 0);

            // 道具加分
            const hasRolling = document.getElementById('rolling').checked;
            const hasAnasa = document.getElementById('anasa').checked;
            const props = hasRolling ? 40 : 0;

            // 结局加分
            let ending = 0;
            
            // 三层关底
            const ending3 = document.querySelector('[name="ending3"]:checked');
            if(ending3) ending += parseInt(ending3.value);
            
            // 五层结局
            const ending5 = document.querySelector('[name="ending5"]:checked');
            if(ending5) {
                switch(ending5.value) {
                    case 'emergency_teaching':
                        ending += hasRolling ? 100 : 50;
                        if(hasAnasa) ending += hasRolling ? 40 : 10;
                        break;
                    case 'chaoyue':
                        ending += hasRolling ? 120 : 60;
                        if(hasAnasa) ending += hasRolling ? 40 : 25;
                        break;
                }
            }
            
            // 六层结局
            const ending6 = document.querySelector('[name="ending6"]:checked');
            if(ending6) {
                switch(ending6.value) {
                    case 'sacred_city':
                        ending += hasRolling ? 50 : 0;
                        break;
                    case 'shoufa':
                        ending += 120;
                        if(hasRolling) ending += 80;
                        if(document.getElementById('kill_kuilong').checked) ending += 120;
                        if(document.getElementById('shoufa_mind_chaos').checked) ending += 40;
                        break;
                }
            }

            // 不容拒绝
            let noRefuse = 0;
            const nrRadio = document.querySelector('[name="no_refuse"]:checked');
            if(nrRadio) {
                noRefuse = parseInt(nrRadio.value);
                if(document.getElementById('mind_chaos').checked) {
                    noRefuse += nrRadio.value === '160' ? 80 : 20;
                }
                if(hasRolling) noRefuse += 100;
            }

            // 最终计算
            const settlement = parseInt(document.getElementById('settlement').value) || 0;
            const collection = parseInt(document.getElementById('collection').value) || 0;
            const total = settlement + emergency + special + props + ending + noRefuse - collection *7.5;

            document.getElementById('result').textContent = total.toFixed(1);
        }

        // 重置所有选项
        function resetAll() {
            // 清除所有输入
            document.querySelectorAll('input').forEach(input => {
                if(input.type === 'checkbox' || input.type === 'radio') {
                    input.checked = false;
                } else if(input.type === 'number') {
                    input.value = input.id === 'settlement' ? '0' : '0';
                }
            });
            // 隐藏额外选项
            document.getElementById('shoufaExtra').style.display = 'none';
            calculate();
        }

        // 事件绑定
        document.querySelectorAll('input, select').forEach(el => el.addEventListener('change', calculate));
        document.getElementById('settlement').addEventListener('input', calculate);
        document.getElementById('collection').addEventListener('input', calculate);
        // 初始化计算
        calculate();
    </script>
</body>
</html>